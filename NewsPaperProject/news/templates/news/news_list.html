{% extends 'news/default.html' %}
{% load auth_extras %}

{% block title %}–ù–æ–≤–æ—Å—Ç–Ω–æ–π –ø–æ—Ä—Ç–∞–ª - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏{% endblock %}

{% block content %}
<div class="news-list-container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <div class="page-header" style="margin-bottom: 30px;">
        <h1 style="color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 15px;">
            üì∞ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
        </h1>

        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}"
                 style="padding: 15px; margin-bottom: 20px; border-radius: 8px;
                        background-color: {% if message.tags == 'success' %}#d4edda{% elif message.tags == 'error' %}#f8d7da{% else %}#d1ecf1{% endif %};
                        color: {% if message.tags == 'success' %}#155724{% elif message.tags == 'error' %}#721c24{% else %}#0c5460{% endif %};
                        border: 1px solid {% if message.tags == 'success' %}#c3e6cb{% elif message.tags == 'error' %}#f5c6cb{% else %}#bee5eb{% endif %};">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="list-info" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <div>
                <p style="color: #666; margin: 0;">
                    –í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π: <strong>{{ news_list.count }}</strong>
                </p>
            </div>

            <div class="actions">
                {% if user.is_authenticated and user|has_group:'authors' %}
                <a href="{% url 'news_create' %}"
                   class="btn btn-success"
                   style="padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; margin-right: 10px;">
                    ‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å
                </a>
                <a href="{% url 'article_create' %}"
                   class="btn btn-info"
                   style="padding: 10px 20px; background-color: #17a2b8; color: white; text-decoration: none; border-radius: 5px;">
                    üìù –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    {% if news_list %}
    <div class="news-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px;">
        {% for news in news_list %}
        <div class="news-card"
             style="background-color: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: transform 0.3s, box-shadow 0.3s;">

            <!-- –¢–∏–ø –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
            <div class="post-type" style="background-color: {% if news.post_type == 'NW' %}#3498db{% else %}#2ecc71{% endif %}; padding: 8px 15px;">
                <span style="color: white; font-weight: bold; font-size: 12px; text-transform: uppercase;">
                    {% if news.post_type == 'NW' %}–ù–æ–≤–æ—Å—Ç—å{% else %}–°—Ç–∞—Ç—å—è{% endif %}
                </span>
            </div>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ -->
            <div class="card-content" style="padding: 25px;">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 20px;">
                    <a href="{% url 'news_detail' news.id %}"
                       style="color: #2c3e50; text-decoration: none; transition: color 0.3s;">
                        {{ news.title|truncatechars:70 }}
                    </a>
                </h3>

                <!-- –ö—Ä–∞—Ç–∫–∏–π —Ç–µ–∫—Å—Ç -->
                <div class="news-preview" style="margin-bottom: 20px; color: #555; line-height: 1.6;">
                    {{ news.text|truncatechars:150|linebreaks }}
                </div>

                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥–ø–∏—Å–∫–∏ -->
                {% if news.categories.all %}
                <div class="categories-section" style="margin-bottom: 20px;">
                    <h4 style="font-size: 14px; color: #666; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">
                        üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏:
                    </h4>
                    <div class="categories-list" style="display: flex; flex-wrap: wrap; gap: 8px;">
                        {% for category in news.categories.all %}
                        <div class="category-tag"
                             style="display: inline-flex; align-items: center; background-color: #ecf0f1; padding: 5px 12px; border-radius: 20px; font-size: 13px;">

                            <!-- –ò–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                            <a href="{% url 'category_news' category.id %}"
                               style="color: #2c3e50; text-decoration: none; margin-right: 8px; font-weight: 500;">
                                {{ category.name }}
                            </a>

                            <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
                            {% if user.is_authenticated %}
                            <div class="subscription-action">
                                {% if user in category.subscribers.all %}
                                <!-- –£–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω - –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø–∏—Å–∫–∏ -->
                                <a href="{% url 'unsubscribe' category.id %}"
                                   class="unsubscribe-btn"
                                   style="display: inline-flex; align-items: center; justify-content: center;
                                          width: 24px; height: 24px; background-color: #e74c3c; color: white;
                                          border-radius: 50%; text-decoration: none; font-size: 12px;
                                          transition: background-color 0.3s;"
                                   title="–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç {{ category.name }}">
                                    ‚úï
                                </a>
                                {% else %}
                                <!-- –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω - –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
                                <a href="{% url 'subscribe' category.id %}"
                                   class="subscribe-btn"
                                   style="display: inline-flex; align-items: center; justify-content: center;
                                          width: 24px; height: 24px; background-color: #2ecc71; color: white;
                                          border-radius: 50%; text-decoration: none; font-size: 14px;
                                          transition: background-color 0.3s;"
                                   title="–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ {{ category.name }}">
                                    +
                                </a>
                                {% endif %}
                            </div>
                            {% else %}
                            <!-- –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Ö–æ–¥ -->
                            <a href="{% url 'account_login' %}?next={{ request.path }}"
                               style="color: #3498db; font-size: 11px; margin-left: 5px; text-decoration: none;"
                               title="–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è">
                                –≤–æ–π—Ç–∏
                            </a>
                            {% endif %}

                            <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ -->
                            <span class="subscriber-count"
                                  style="margin-left: 8px; font-size: 11px; color: #7f8c8d;"
                                  title="{{ category.subscribers.count }} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤">
                                üë• {{ category.subscribers.count }}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–µ –∏ –¥–∞—Ç–µ -->
                <div class="news-meta" style="display: flex; justify-content: space-between; align-items: center;
                                              margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <div class="author-info" style="color: #666; font-size: 14px;">
                        <span style="color: #3498db; font-weight: bold;">{{ news.author.username }}</span>
                        <span style="margin: 0 5px;">‚Ä¢</span>
                        <span>{{ news.created_at|date:"d.m.Y H:i" }}</span>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="news-stats" style="font-size: 13px; color: #95a5a6;">
                        <span title="–ü—Ä–æ—Å–º–æ—Ç—Ä—ã">üëÅÔ∏è 0</span>
                        <span style="margin-left: 10px;" title="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏">üí¨ 0</span>
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∞–≤—Ç–æ—Ä–∞ -->
                {% if user.is_authenticated and user == news.author and user|has_group:'authors' %}
                <div class="author-actions"
                     style="display: flex; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px dashed #ddd;">

                    {% if news.post_type == 'NW' %}
                    <a href="{% url 'news_edit' news.id %}"
                       class="btn btn-sm btn-primary"
                       style="padding: 8px 15px; background-color: #3498db; color: white; text-decoration: none;
                              border-radius: 4px; font-size: 13px; flex: 1; text-align: center;">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{% url 'news_delete' news.id %}"
                       class="btn btn-sm btn-danger"
                       style="padding: 8px 15px; background-color: #e74c3c; color: white; text-decoration: none;
                              border-radius: 4px; font-size: 13px; flex: 1; text-align: center;">
                        –£–¥–∞–ª–∏—Ç—å
                    </a>
                    {% else %}
                    <a href="{% url 'article_edit' news.id %}"
                       class="btn btn-sm btn-primary"
                       style="padding: 8px 15px; background-color: #3498db; color: white; text-decoration: none;
                              border-radius: 4px; font-size: 13px; flex: 1; text-align: center;">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{% url 'article_delete' news.id %}"
                       class="btn btn-sm btn-danger"
                       style="padding: 8px 15px; background-color: #e74c3c; color: white; text-decoration: none;
                              border-radius: 4px; font-size: 13px; flex: 1; text-align: center;">
                        –£–¥–∞–ª–∏—Ç—å
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- –•–æ–≤–µ—Ä —ç—Ñ—Ñ–µ–∫—Ç -->
            <style>
                .news-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                }
                .news-card:hover h3 a {
                    color: #3498db;
                }
                .subscribe-btn:hover {
                    background-color: #27ae60 !important;
                    transform: scale(1.1);
                }
                .unsubscribe-btn:hover {
                    background-color: #c0392b !important;
                    transform: scale(1.1);
                }
            </style>
        </div>
        {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if is_paginated %}
    <div class="pagination" style="margin-top: 50px; text-align: center;">
        <div style="display: inline-flex; gap: 10px; align-items: center;">
            {% if page_obj.has_previous %}
            <a href="?page=1"
               style="padding: 8px 15px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px;">
                &laquo; –ü–µ—Ä–≤–∞—è
            </a>
            <a href="?page={{ page_obj.previous_page_number }}"
               style="padding: 8px 15px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px;">
                –ù–∞–∑–∞–¥
            </a>
            {% endif %}

            <span style="padding: 8px 15px; background-color: #ecf0f1; border-radius: 5px;">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}"
               style="padding: 8px 15px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px;">
                –í–ø–µ—Ä–µ–¥
            </a>
            <a href="?page={{ page_obj.paginator.num_pages }}"
               style="padding: 8px 15px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px;">
                –ü–æ—Å–ª–µ–¥–Ω—è—è &raquo;
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state" style="text-align: center; padding: 60px 20px; background-color: #f8f9fa; border-radius: 10px;">
        <div style="font-size: 60px; color: #bdc3c7; margin-bottom: 20px;">üìÑ</div>
        <h2 style="color: #7f8c8d; margin-bottom: 15px;">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h2>
        <p style="color: #95a5a6; max-width: 500px; margin: 0 auto 30px; line-height: 1.6;">
            –ù–∞ —Å–∞–π—Ç–µ –µ—â—ë –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏ –∏–ª–∏ —Å—Ç–∞—Ç—å–∏.
            –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –ø–æ–¥–µ–ª–∏—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π!
        </p>

        {% if user.is_authenticated and user|has_group:'authors' %}
        <div style="display: flex; gap: 15px; justify-content: center;">
            <a href="{% url 'news_create' %}"
               class="btn btn-primary"
               style="padding: 12px 30px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
                –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å
            </a>
            <a href="{% url 'article_create' %}"
               class="btn btn-success"
               style="padding: 12px 30px; background-color: #2ecc71; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
                –ù–∞–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç—å—é
            </a>
        </div>
        {% else %}
        <a href="{% url 'account_login' %}"
           class="btn btn-primary"
           style="padding: 12px 30px; background-color: #3498db; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
            –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å
        </a>
        {% endif %}
    </div>
    {% endif %}

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö -->
    {% if user.is_authenticated %}
    <div class="subscriptions-info"
         style="margin-top: 50px; padding: 25px; background-color: #f8f9fa; border-radius: 10px; border-left: 5px solid #3498db;">

        <div style="display: flex; align-items: center; margin-bottom: 15px;">
            <div style="font-size: 24px; margin-right: 15px;">üì®</div>
            <h3 style="margin: 0; color: #2c3e50;">–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫</h3>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div class="info-card" style="padding: 15px; background-color: white; border-radius: 8px;">
                <h4 style="margin-top: 0; color: #3498db; font-size: 16px;">–ö–∞–∫ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è?</h4>
                <p style="color: #555; font-size: 14px; line-height: 1.5;">
                    –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É <span style="display: inline-block; width: 24px; height: 24px; background-color: #2ecc71; color: white; border-radius: 50%; text-align: center; line-height: 24px; font-size: 14px;">+</span> —Ä—è–¥–æ–º —Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π. –í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏—è—Ö –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
                </p>
            </div>

            <div class="info-card" style="padding: 15px; background-color: white; border-radius: 8px;">
                <h4 style="margin-top: 0; color: #3498db; font-size: 16px;">–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏</h4>
                <p style="color: #555; font-size: 14px; line-height: 1.5;">
                    <a href="{% url 'my_subscriptions' %}"
                       style="color: #3498db; text-decoration: none; font-weight: bold;">
                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí
                    </a>
                </p>
                <p style="color: #7f8c8d; font-size: 13px; margin-top: 10px;">
                    –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å–æ–∫: <strong>{{ user.subscribed_categories.count }}</strong>
                </p>
            </div>

            <div class="info-card" style="padding: 15px; background-color: white; border-radius: 8px;">
                <h4 style="margin-top: 0; color: #3498db; font-size: 16px;">–ß—Ç–æ –ø–æ–ª—É—á–∞—é—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–∏?</h4>
                <ul style="color: #555; font-size: 14px; line-height: 1.5; padding-left: 20px; margin: 0;">
                    <li>Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å—Ç–∞—Ç—å—è—Ö</li>
                    <li>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –Ω–∞—á–∞–ª–æ —Å—Ç–∞—Ç—å–∏ –≤ –ø–∏—Å—å–º–µ</li>
                    <li>–°—Å—ã–ª–∫—É –Ω–∞ –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é</li>
                </ul>
            </div>
        </div>
    </div>
    {% else %}
    <div class="subscribe-promo"
         style="margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #3498db, #2c3e50); color: white; border-radius: 10px; text-align: center;">

        <h3 style="margin-top: 0; margin-bottom: 15px;">üíå –ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏!</h3>
        <p style="margin-bottom: 25px; font-size: 16px; opacity: 0.9;">
            –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏—è—Ö
        </p>

        <div style="display: flex; gap: 15px; justify-content: center;">
            <a href="{% url 'account_login' %}"
               class="btn btn-light"
               style="padding: 12px 30px; background-color: white; color: #3498db; text-decoration: none; border-radius: 5px; font-weight: bold;">
                –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
            </a>
            <a href="{% url 'account_signup' %}"
               class="btn btn-outline-light"
               style="padding: 12px 30px; background-color: transparent; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; border: 2px solid white;">
                –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </a>
        </div>
    </div>
    {% endif %}
</div>

<!-- JavaScript –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø–∏—Å–∫–∏
    document.querySelectorAll('.unsubscribe-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            const categoryName = this.getAttribute('title').replace('–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç ', '');
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${categoryName}"?`)) {
                e.preventDefault();
            }
        });
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
    document.querySelectorAll('.subscribe-btn, .unsubscribe-btn').forEach(button => {
        button.addEventListener('click', function() {
            this.style.transform = 'scale(0.8)';
            setTimeout(() => {
                this.style.transform = '';
            }, 300);
        });
    });
});
</script>
{% endblock %}