{% extends 'news/base_form.html' %}
{% load static %}

{% block form_title %}
    {% if object %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏{% endif %}
{% endblock %}

{% block form_fields %}
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏) -->
    {% if not object and user.is_authenticated %}
    <div class="post-limit-container"
         style="margin-bottom: 30px; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ª–∏–º–∏—Ç–∞ -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="font-size: 20px;">üìä</div>
                <div>
                    <h4 style="margin: 0; font-size: 16px; font-weight: 600;">–õ–∏–º–∏—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h4>
                    <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">
                        {% now "d.m.Y" %}
                    </p>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div style="background-color: white; padding: 20px;">
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span style="font-size: 14px; color: #666;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:</span>
                    <span style="font-weight: bold; color: #2c3e50;">
                        {{ today_posts_count }} –∏–∑ 3 –Ω–æ–≤–æ—Å—Ç–µ–π
                    </span>
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤–∏–∑—É–∞–ª—å–Ω—ã–π -->
                <div style="height: 12px; background-color: #f0f0f0; border-radius: 6px; overflow: hidden; position: relative;">
                    <div style="height: 100%; width: {% widthratio today_posts_count 3 100 %}%;
                                background: linear-gradient(90deg,
                                {% if today_posts_count == 0 %}#4CAF50
                                {% elif today_posts_count == 1 %}#8BC34A
                                {% elif today_posts_count == 2 %}#FF9800
                                {% else %}#F44336{% endif %} 0%,
                                {% if today_posts_count == 0 %}#2E7D32
                                {% elif today_posts_count == 1 %}#689F38
                                {% elif today_posts_count == 2 %}#EF6C00
                                {% else %}#C62828{% endif %} 100%);
                                transition: width 0.5s ease;">
                    </div>

                    <!-- –ú–∞—Ä–∫–µ—Ä—ã –ª–∏–º–∏—Ç–∞ -->
                    <div style="position: absolute; top: 0; bottom: 0; left: 33.33%; width: 1px; background-color: rgba(0,0,0,0.1);"></div>
                    <div style="position: absolute; top: 0; bottom: 0; left: 66.66%; width: 1px; background-color: rgba(0,0,0,0.1);"></div>
                </div>

                <!-- –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                <div style="text-align: center; margin-top: 5px;">
                    <span style="font-size: 12px; color: #777;">
                        {% widthratio today_posts_count 3 100 %}% –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
                    </span>
                </div>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ -->
            <div style="padding: 15px; border-radius: 8px; margin-bottom: 15px;
                        {% if today_posts_count >= 3 %}
                            background-color: #FFEBEE; border-left: 4px solid #F44336;
                        {% elif today_posts_count == 2 %}
                            background-color: #FFF3E0; border-left: 4px solid #FF9800;
                        {% elif today_posts_count == 1 %}
                            background-color: #F1F8E9; border-left: 4px solid #8BC34A;
                        {% else %}
                            background-color: #E8F5E9; border-left: 4px solid #4CAF50;
                        {% endif %}">

                {% if today_posts_count >= 3 %}
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 18px; color: #F44336;">‚õî</div>
                        <div>
                            <strong style="color: #C62828;">–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω!</strong>
                            <p style="margin: 5px 0 0 0; color: #B71C1C; font-size: 14px;">
                                –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ –Ω–æ–≤–æ—Å—Ç–µ–π —Å–µ–≥–æ–¥–Ω—è.
                                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —Å—Ç–∞—Ç—å—é.
                            </p>
                        </div>
                    </div>

                {% elif today_posts_count == 2 %}
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 18px; color: #FF9800;">‚ö†Ô∏è</div>
                        <div>
                            <strong style="color: #EF6C00;">–û—Å—Ç–æ—Ä–æ–∂–Ω–æ!</strong>
                            <p style="margin: 5px 0 0 0; color: #E65100; font-size: 14px;">
                                –≠—Ç–æ –≤–∞—à–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –Ω–æ–≤–æ—Å—Ç—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.
                                –ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ª–∏–º–∏—Ç –±—É–¥–µ—Ç –∏—Å—á–µ—Ä–ø–∞–Ω.
                            </p>
                        </div>
                    </div>

                {% elif today_posts_count == 1 %}
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 18px; color: #8BC34A;">‚úÖ</div>
                        <div>
                            <strong style="color: #689F38;">–•–æ—Ä–æ—à–∏–π —Ç–µ–º–ø!</strong>
                            <p style="margin: 5px 0 0 0; color: #558B2F; font-size: 14px;">
                                –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å <strong>{{ remaining_posts }}</strong> –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.
                                –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!
                            </p>
                        </div>
                    </div>

                {% else %}
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 18px; color: #4CAF50;">üöÄ</div>
                        <div>
                            <strong style="color: #2E7D32;">–û—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç!</strong>
                            <p style="margin: 5px 0 0 0; color: #1B5E20; font-size: 14px;">
                                –£ –≤–∞—Å –µ—Å—Ç—å –≤—Å–µ <strong>3</strong> –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.
                                –ü—É–±–ª–∏–∫—É–π—Ç–µ —Å —É–º–æ–º!
                            </p>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div style="background-color: #F5F5F5; padding: 12px; border-radius: 6px; font-size: 12px; color: #666;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>üìÖ –°–ª–µ–¥—É—é—â–∏–π —Å–±—Ä–æ—Å:</span>
                    <span style="font-weight: bold;">–∑–∞–≤—Ç—Ä–∞ –≤ 00:00</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>üìù –°—Ç–∞—Ç—å–∏:</span>
                    <span style="color: #2196F3; font-weight: bold;">–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π</span>
                </div>
                <p style="margin: 8px 0 0 0; font-style: italic; color: #888;">
                    –õ–∏–º–∏—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –Ω–æ–≤–æ—Å—Ç—è–º. –í—ã –º–æ–∂–µ—Ç–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
                </p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ï—Å–ª–∏ –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Ñ–æ—Ä–º—ã -->
    {% if not object and today_posts_count >= 3 %}
    <div class="limit-exceeded"
         style="text-align: center; padding: 40px 20px; background-color: white; border-radius: 10px; margin-bottom: 30px;">
        <div style="font-size: 60px; color: #F44336; margin-bottom: 20px;">‚õî</div>
        <h3 style="color: #C62828; margin-bottom: 15px;">–î–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç</h3>
        <p style="color: #666; max-width: 500px; margin: 0 auto 25px; line-height: 1.6;">
            –í—ã —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (3 –∏–∑ 3).
            –õ–∏–º–∏—Ç –æ–±–Ω–æ–≤–∏—Ç—Å—è –∑–∞–≤—Ç—Ä–∞ –≤ 00:00.
        </p>

        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
            <a href="{% url 'article_create' %}"
               class="btn btn-primary"
               style="padding: 12px 25px; background-color: #2196F3; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
                üìù –ù–∞–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç—å—é
            </a>
            <a href="{% url 'news_list' %}"
               class="btn btn-secondary"
               style="padding: 12px 25px; background-color: #757575; color: white; text-decoration: none; border-radius: 5px;">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–æ–≤–æ—Å—Ç—è–º
            </a>
        </div>

        <div style="margin-top: 30px; padding: 15px; background-color: #FFF3E0; border-radius: 8px; max-width: 500px; margin-left: auto; margin-right: auto;">
            <h4 style="margin-top: 0; color: #EF6C00;">üí° –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?</h4>
            <ul style="text-align: left; color: #666; padding-left: 20px; margin-bottom: 0;">
                <li>–ù–∞–ø–∏—à–∏—Ç–µ <strong>—Å—Ç–∞—Ç—å—é</strong> –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ—Å—Ç–∏ (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)</li>
                <li>–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</li>
                <li>–ü–æ–æ–±—â–∞–π—Ç–µ—Å—å —Å —á–∏—Ç–∞—Ç–µ–ª—è–º–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö</li>
                <li>–ò–∑—É—á–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</li>
            </ul>
        </div>

        <!-- –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É, –µ—Å–ª–∏ –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω -->
        <style>
            form {
                display: none;
            }
            .form-actions {
                display: none;
            }
        </style>
    </div>
    {% endif %}

    <!-- –ü–æ–ª—è —Ñ–æ—Ä–º—ã (—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–Ω–æ–º –ª–∏–º–∏—Ç–µ) -->
    <div class="form-section"
         {% if not object and today_posts_count >= 3 %}style="display: none;"{% endif %}>

        <!-- –ü–æ–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label for="id_title" style="display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50;">
                üìå –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏ *
                <span style="font-size: 12px; color: #666; font-weight: normal; margin-left: 5px;">
                    (–º–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤)
                </span>
            </label>
            {{ form.title }}
            {% if form.title.errors %}
                <div class="error" style="color: #F44336; font-size: 13px; margin-top: 5px;">
                    {{ form.title.errors }}
                </div>
            {% endif %}
            <div class="help-text" style="color: #666; font-size: 13px; margin-top: 5px;">
                –ü—Ä–∏–¥—É–º–∞–π—Ç–µ —è—Ä–∫–∏–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
            </div>
        </div>

        <!-- –ü–æ–ª–µ —Ç–µ–∫—Å—Ç–∞ -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label for="id_text" style="display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50;">
                üìù –¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ *
                <span style="font-size: 12px; color: #666; font-weight: normal; margin-left: 5px;">
                    (–º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤)
                </span>
            </label>
            {{ form.text }}
            {% if form.text.errors %}
                <div class="error" style="color: #F44336; font-size: 13px; margin-top: 5px;">
                    {{ form.text.errors }}
                </div>
            {% endif %}
            <div class="help-text" style="color: #666; font-size: 13px; margin-top: 5px;">
                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è HTML —Ä–∞–∑–º–µ—Ç–∫–∞. –ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö.
            </div>

            <!-- –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ -->
            <div id="char-counter" style="text-align: right; font-size: 12px; color: #777; margin-top: 5px;">
                <span id="char-count">0</span> —Å–∏–º–≤–æ–ª–æ–≤
            </div>
        </div>

        <!-- –ü–æ–ª–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div class="form-group" style="margin-bottom: 25px;">
            <label for="id_categories" style="display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50;">
                üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
                <span style="font-size: 12px; color: #666; font-weight: normal; margin-left: 5px;">
                    (–≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
                </span>
            </label>
            {{ form.categories }}
            {% if form.categories.errors %}
                <div class="error" style="color: #F44336; font-size: 13px; margin-top: 5px;">
                    {{ form.categories.errors }}
                </div>
            {% endif %}
            <div class="help-text" style="color: #666; font-size: 13px; margin-top: 5px;">
                –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–ª—É—á–∞—Ç email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
                –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl (Cmd –Ω–∞ Mac) –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞—Ö -->
            <div id="subscribers-info" style="margin-top: 10px; padding: 10px; background-color: #E3F2FD; border-radius: 5px; display: none;">
                <p style="margin: 0; color: #1565C0; font-size: 13px;">
                    <span id="total-subscribers">0</span> –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                </p>
            </div>
        </div>

        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Ç–∏–ø–∞ –ø–æ—Å—Ç–∞ -->
        {{ form.post_type.as_hidden }}

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        {% if object %}
            <div class="edit-info" style="background-color: #F5F5F5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="margin-top: 0; color: #2c3e50;">üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤–æ—Å—Ç–∏</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; font-size: 14px;">
                    <div>
                        <strong>–ê–≤—Ç–æ—Ä:</strong>
                        <div style="color: #666;">{{ object.author.username }}</div>
                    </div>
                    <div>
                        <strong>–°–æ–∑–¥–∞–Ω–∞:</strong>
                        <div style="color: #666;">{{ object.created_at|date:"d.m.Y H:i" }}</div>
                    </div>
                    <div>
                        <strong>–û–±–Ω–æ–≤–ª–µ–Ω–∞:</strong>
                        <div style="color: #666;">{{ object.updated_at|date:"d.m.Y H:i" }}</div>
                    </div>
                    <div>
                        <strong>–¢–∏–ø:</strong>
                        <div style="color: #666;">{{ object.get_post_type_display }}</div>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± email —Ä–∞—Å—Å—ã–ª–∫–µ -->
        {% if not object and today_posts_count < 3 %}
        <div class="notification-info"
             style="background-color: #FFF3E0; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #FF9800;">
            <div style="display: flex; align-items: flex-start; gap: 10px;">
                <div style="font-size: 18px; color: #FF9800;">üìß</div>
                <div>
                    <strong style="color: #EF6C00;">Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</strong>
                    <p style="margin: 8px 0 0 0; color: #666; font-size: 14px;">
                        –ü–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–∏ –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                        –ø–æ–ª—É—á–∞—Ç email —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –Ω–∞—á–∞–ª–æ–º –≤–∞—à–µ–π –Ω–æ–≤–æ—Å—Ç–∏.
                    </p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}

{% block submit_button %}
    {% if object %}üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}
        {% if today_posts_count >= 3 %}
            ‚õî –õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω
        {% else %}
            üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å
        {% endif %}
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –Ω–æ–≤–æ—Å—Ç–∏
    const textArea = document.querySelector('textarea[name="text"]');
    const charCount = document.getElementById('char-count');

    if (textArea && charCount) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        charCount.textContent = textArea.value.length;

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
        textArea.addEventListener('input', function() {
            charCount.textContent = this.value.length;

            // –ò–∑–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
            if (this.value.length < 50) {
                charCount.style.color = '#F44336';
            } else if (this.value.length > 1000) {
                charCount.style.color = '#FF9800';
            } else {
                charCount.style.color = '#4CAF50';
            }
        });
    }

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    const categorySelect = document.querySelector('select[name="categories"]');
    const subscribersInfo = document.getElementById('subscribers-info');
    const totalSubscribers = document.getElementById('total-subscribers');

    if (categorySelect) {
        // –î–∞–Ω–Ω—ã–µ –æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–∑–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–µ–Ω AJAX)
        const subscribersData = {
            // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: category_id: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
            // –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        };

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞—Ö
        function updateSubscribersInfo() {
            const selectedOptions = Array.from(categorySelect.selectedOptions);
            let total = 0;

            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            selectedOptions.forEach(option => {
                const categoryId = option.value;
                // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
                // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
                total += Math.floor(Math.random() * 50) + 10;
            });

            if (selectedOptions.length > 0) {
                totalSubscribers.textContent = total;
                subscribersInfo.style.display = 'block';
            } else {
                subscribersInfo.style.display = 'none';
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
        categorySelect.addEventListener('change', updateSubscribersInfo);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateSubscribersInfo();
    }

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–Ω–æ–º –ª–∏–º–∏—Ç–µ
    const submitButton = document.querySelector('button[type="submit"]');
    if (submitButton && {{ today_posts_count|default:0 }} >= 3 && !{{ object.pk|default:0 }}) {
        submitButton.disabled = true;
        submitButton.style.opacity = '0.6';
        submitButton.style.cursor = 'not-allowed';
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const title = document.querySelector('input[name="title"]').value.trim();
            const text = document.querySelector('textarea[name="text"]').value.trim();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            if (title.length === 0) {
                alert('–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
                e.preventDefault();
                return;
            }

            if (title.length > 200) {
                alert('–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (–º–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤)');
                e.preventDefault();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞
            if (text.length < 50) {
                alert('–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤');
                e.preventDefault();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            const categories = Array.from(document.querySelectorAll('select[name="categories"] option:checked'));
            if (categories.length === 0) {
                if (!confirm('–í—ã –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π?')) {
                    e.preventDefault();
                    return;
                }
            }
        });
    }

    // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
    const tooltips = {
        'title': '–Ø—Ä–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–≤–ª–µ—á–µ—Ç –±–æ–ª—å—à–µ —á–∏—Ç–∞—Ç–µ–ª–µ–π',
        'text': '–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö',
        'categories': '–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —ç—Ç–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ'
    };

    Object.keys(tooltips).forEach(field => {
        const input = document.querySelector(`[name="${field}"]`);
        if (input) {
            input.title = tooltips[field];
        }
    });
});
</script>
{% endblock %}